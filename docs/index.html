<!DOCTYPE html>
<html>
<head>
    <title>Rules</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
    <meta property="og:site_name" content="markdown"/>
    <meta property="og:locale" content="ru_RU"/>
    <meta property="og:type" content="contract"/>
    <meta property="og:title" content="markdown"/>
    <meta property="og:description" content="markdown"/>
    <meta property="og:url" content="https://zababurinsv.github.io/design/"/>
    <meta property="og:image" content="https://i.imgur.com/pSrPUkJ.jpg"/>
    <meta property="og:image:width" content="537"/>
    <meta property="og:image:height" content="240"/>
    <link rel="stylesheet"
          href="/services/rules/src/component/fer-notification/views/mjs/notification/styles/index.css">
    <link rel="shortcut icon"
          href="data:image/png;base64, AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbbv+DGW3/mRlt/5kZbf+ZGq6/hIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGa3/ohkt/7/Zbj//2S3/v9lt/6WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGm5/iRlt/74Zbj//2W4//9luP//Zbf++mi4/i4gIPciGhr24hsb9uwbG/bsGhr24CEh9xoAAAAAAAAAAAAAAABnuP5mZLf+/2W4//9luP//Zbj//2S3/v9muP5yGBj2rhMT9v8TE/b/ExP2/xMT9f8YGPWkAAAAAAAAAAAAAAAAb7z/BGW3/tZluP//Zbj//2W4//9lt/7gJzH3ShMT9f8TE/b/ExP2/xMT9v8TE/b/ExP1/CAg9joAAAAAAAAAAAAAAABmuP5GZLf+6GS3/uhkt/7oZbf+UhgY9YQSEvX/ExP2/xMT9v8TE/b/ExP2/xIS9f8aGvZ8AAAAAD4++gQgIPZ6IiL2hiIi9oYgIPZ8KCj5BAAAAAAtLfgUFBT17BMT9v8TE/b/ExP2/xMT9v8VFfXoLCz4DgAAAAAaGvZqEhL1/xMT9v8TE/b/EhL1/xsb9nIAAAAAAAAAABwc9m4SEvX/ExP2/xMT9v8SEvX/HR32ZAAAAAAnJ/gSFRX16hMT9v8TE/b/ExP2/xMT9v8UFPXuJyf4Fp2xlAKNnqUYLC/mfhYW83ATE/VuFxf1aDc3+gIAAAAAGBj1fhIS9f8TE/b/ExP2/xMT9v8TE/b/ExP1/xkZ9YaGn3yIhZ57/4Wee/+Gn3yKAAAAAAAAAAAAAAAAAAAAACMj9zYTE/X8ExP2/xMT9v8TE/b/ExP2/xMT9f9JUshihZ57+IaffP+Gn3z/hZ579oigfiYAAAAAAAAAAAAAAAAAAAAAGBj1oBIS9f8TE/b/ExP2/xMT9f8YGPWmiKB+PIWee/+Gn3z/hp98/4Wee/+HoH06AAAAAAAAAAAAAAAAAAAAACUl9xgVFfXOExP11BMT9dQUFPXQJib3HgAAAACGn3ymhp98/4affP+Gn3ymAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiKB+EIihf0CIoX9AiKB+EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADg/wAA4MMAAOCBAADggQAA8QEAAOeBAADDwwAAgf8AAIAPAACBDwAAgQ8AAMMPAAD//wAA//8AAA=="
          type="image/png">
    <style>
        html {
            font-size: 1vmin;
        }

        body {
            margin: 0;
            padding: 0;
            scrollbar-gutter: stable;
            overflow-x: hidden;
        }

        .auth {
            z-index: 20;
            position: absolute;
        }


        fer-region::-webkit-scrollbar {
            width: 0
        }

        fer-region::-webkit-scrollbar {
            display: none;
        }

        fer-region::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
<auction-auth
  open="true"
  data-services-path="mss"
  data-css-shadow="auth_rules"
>
    <template>
        <div class="auction-auth">
            <div class="auction-auth__wallet">
                <h2 class="auction-auth__wallet_title">Вход</h2>
                <div class="auction-auth__wallet_content">
                    Федеральная электронная регистратура <br>
                    Агрегированная витрина расписаний Минздрава России<br>
                    Федеральный модуль валидации расписаний
                </div>
                <button id="auction-auth__button-login">Войти с помощью ЕГИСЗ</button>
            </div>
        </div>
    </template>
</auction-auth>
<div class="service" slot="service"></div>
<mss-filter
  id="bodyFilterTop"
  style="display: none"
  data-services-path="mss"
  data-css-shadow="mss"
  slot="body_before"
>
    <template>
        <div class="container">
            <fer-select
              data-value="Фильтр 1"
              data-services-path="mss"
              data-css-shadow="mss"
            >
                <div class="dropdown">
                    <div class="dropdown__wrapper">
                        <div class="dropdown_input">
                            <button class="dropdown__button" type="button">Фильтр 1</button>
                        </div>
                        <div class="dropdown__button_arrow">

                        </div>
                    </div>
                    <ul class="dropdown__list">
                        <li class="dropdown__list-item" data-event-snapshot-id="1756c3b2-94f3-45ee-bded-f49ec4c37645"
                            data-event-id="097f14fd-2561-45ae-93b8-c6c383c08ffa"
                            data-schema-id="showcase.booking.mo.1.0.0" data-value="showcase.booking.mo.1.0.0">
                            showcase.booking.mo.1.0.0
                        </li>
                        <li class="dropdown__list-item" data-event-snapshot-id="6ccb96ce-2191-4fc5-8eb3-de67ab5c64d4"
                            data-event-id="34999933-ff08-4bd4-9a81-a4df6882259d"
                            data-schema-id="showcase.booking.resource.1.0.0"
                            data-value="showcase.booking.resource.1.0.0">showcase.booking.resource.1.0.0
                        </li>
                        <li class="dropdown__list-item" data-event-snapshot-id="e6fe7a00-af2f-459c-b5a2-8fb9a28626a3"
                            data-event-id="b82d6712-04c9-4cbf-a179-bcbefef5e89e"
                            data-schema-id="showcase.booking.service.1.0.0" data-value="showcase.booking.service.1.0.0">
                            showcase.booking.service.1.0.0
                        </li>
                    </ul>
                    <input class="dropdown__input_hidden" type="text" name="select-category" value="Фильтр 1" />
                </div>
            </fer-select>

            <fer-select
              data-value="Фильтр 2"
              data-services-path="mss"
              data-css-shadow="mss"
            >
                <div class="dropdown">
                    <div class="dropdown__wrapper">
                        <div class="dropdown_input">
                            <button class="dropdown__button" type="button">Фильтр 2</button>
                        </div>
                        <div class="dropdown__button_arrow">

                        </div>
                    </div>
                    <ul class="dropdown__list">
                        <li class="dropdown__list-item" data-event-snapshot-id="1756c3b2-94f3-45ee-bded-f49ec4c37645"
                            data-event-id="097f14fd-2561-45ae-93b8-c6c383c08ffa"
                            data-schema-id="showcase.booking.mo.1.0.0" data-value="showcase.booking.mo.1.0.0">
                            showcase.booking.mo.1.0.0
                        </li>
                        <li class="dropdown__list-item" data-event-snapshot-id="6ccb96ce-2191-4fc5-8eb3-de67ab5c64d4"
                            data-event-id="34999933-ff08-4bd4-9a81-a4df6882259d"
                            data-schema-id="showcase.booking.resource.1.0.0"
                            data-value="showcase.booking.resource.1.0.0">showcase.booking.resource.1.0.0
                        </li>
                        <li class="dropdown__list-item" data-event-snapshot-id="e6fe7a00-af2f-459c-b5a2-8fb9a28626a3"
                            data-event-id="b82d6712-04c9-4cbf-a179-bcbefef5e89e"
                            data-schema-id="showcase.booking.service.1.0.0" data-value="showcase.booking.service.1.0.0">
                            showcase.booking.service.1.0.0
                        </li>
                    </ul>
                    <input class="dropdown__input_hidden" type="text" name="select-category" value="Фильтр 1" />
                </div>
            </fer-select>
            <div class="button_add">
                Добавить запись
            </div>
        </div>
    </template>
</mss-filter>
<fer-notification data-services-path="mss"></fer-notification>
<fer-dialog
  data-services-path="mss"
>
    <dialog>
        <div class="content"></div>
    </dialog>
</fer-dialog>
</body>
<script type="module">
    import { env } from '/env.mjs';

    document.addEventListener('fwDateInput', () => {
        console.log('#########################################')
    })

    document.addEventListener('fwChange', () => {
        console.log('#########################################')
    })

    window.addEventListener('fwDateInput', () => {
        console.log('################ 2 #########################')
    })

    window.addEventListener('fwChange', () => {
        console.log('################## 2 #######################')
    })
    localStorage.clear();
    const dapp = env().DAPP;

    const auctionAuth = document.body.querySelector('auction-auth');
    const ferDialog = document.body.querySelector('fer-dialog');
    const ferNotification = document.body.querySelector('fer-notification');

    auctionAuth.dataset.servicesPath = dapp;
    ferDialog.dataset.servicesPath = dapp;
    ferNotification.dataset.servicesPath = dapp;

    await import(`/services/${dapp}/src/component/json-ld/dist/jsonld.esm.js`);
    const jsonld = window.jsonld
    // const jsonldChecker = await import(`/services/${dapp}/src/this/mjs/jsonld-checker/src/index.mjs`);

    const true_test = {
        "@context": [
            {
                "@version": 1.1,
                "schema": "http://localhost:3333/",
                "name": {
                    "@id":"schema"
                },
                "data": {
                    "@id":"schema"
                },
                "genesis": {
                    "@id": "schema"
                },
                "welcomebook": {
                    "@id": "schema"
                },
                "mss": {
                    "@id": "schema:mss"
                },
                "rule": {
                    "@id": "schema:rule"
                },
                "checklist": {
                    "@id": "schema:checklist"
                }
            }
        ],
        "@type": "mss",
        "name": {
            "data":"test"
        }
    }

    let result = {}
    try {
        let options = {}
        options.format = 'application/n-quads';
        const promise = await jsonld.canonize(true_test, options);
    } catch (e) {
        result = e.details
    }

    console.log(window.JSON.stringify(result, null, 4))

    const JSON_WELCOMEBOOK = {
        "@context": {
            "@version": 1.1,
            "schema": "http://localhost:3333/",
            "genesis": { "@id": "schema"},
            "node": { "@id": "schema"},
            "name": { "@id": "schema:name"},
            "type": {
                "@id": "schema:services",
                "@container": "@list"
            }  ,
            "services": {
                "@id": "http://localhost:3333/services",
                "@container": "@list"
            }
        },
        "@id": "http://localhost:3333/",
        "type": [{
            "@id": "_:t0",
            "@type": "genesis",
            "name": "system",
            "node": {
                "@id": "http://localhost:3333/",
                "services": [
                    {
                        "@id": "http://localhost:3333/",
                        "name": "mss"
                    },
                    {
                        "@id": "http://localhost:3333/",
                        "name": "rules"
                    }
                ]
            }
        }, {
            "@id": "_:t1",
            "@type": "genesis",
            "name": "system",
            "services": [
                {
                    "@id": "http://localhost:3333/mss",
                    "name": "mss"
                },
                {
                    "@id": "http://localhost:3333/rules",
                    "name": "rules"
                }
            ]
        }]
    }


    // console.log(jsonldChecker.isJsonLdObject(JSON_WELCOMEBOOK))
    // const resultOk = await jsonldChecker.check(JSON_WELCOMEBOOK);
    // console.log(result);
    // debugger
    // console.log('jsonldChecker', jsonldChecker)
    // debugger
    // console.log('jsonldChecker', jsonldChecker)
    // debugger


    const JSON = {
        "@context": [
            "https://api.conceptnet.io/ld/conceptnet5.7/context.ld.json"
        ],
        "@id": "/a/[/r/UsedFor/,/c/en/example/,/c/en/explain/]",
        "@type": "Edge",
        "dataset": "/d/conceptnet/4/en",
        "end": {
            "@id": "/c/en/explain",
            "@type": "Node",
            "label": "explain something",
            "language": "en",
            "term": "/c/en/explain"
        },
        "license": "cc:by/4.0",
        "rel": {
            "@id": "/r/UsedFor",
            "@type": "Relation",
            "label": "UsedFor"
        },
        "sources": [
            {
                "@id": "/and/[/s/activity/omcs/omcs1_possibly_free_text/,/s/contributor/omcs/pavlos/]",
                "@type": "Source",
                "activity": "/s/activity/omcs/omcs1_possibly_free_text",
                "contributor": "/s/contributor/omcs/pavlos"
            }
        ],
        "start": {
            "@id": "/c/en/example",
            "@type": "Node",
            "label": "an example",
            "language": "en",
            "term": "/c/en/example"
        },
        "surfaceText": "You can use [[an example]] to [[explain something]]",
        "version": "5.8.1",
        "weight": 1.0
    }

    // const expandList = await jsonld.expand(JSON, {safe: false});

    // console.log('sssssssssss',)
    // const compacted = await jsonld.compact(expandList, context);

    // const flattenList = await jsonld.flatten(JSON, {safe: false});

    let changeService = {
        genesis: {
            name: 'system',
            pathname: '/services/system/src',
            children: ['mss', 'rules'],
            mapping: ['name', 'body']
        }
    };

    changeService = Object.assign(changeService, {
        [changeService.genesis.children[0]]: {
            [changeService.genesis.mapping[0]]: changeService.genesis.children[0],
            [changeService.genesis.mapping[1]]: {
                filter: {
                    top: true
                }
            },
            [changeService.genesis.name]: {
                header: true,
                relation: true,
                body: true,
                property: false,
                footer: true
            },
        },
        [changeService.genesis.children[1]]: {
            [changeService.genesis.mapping[0]]: changeService.genesis.children[1],
            [changeService.genesis.mapping[1]]: {
                filter: {
                    top: false
                }
            },
            [changeService.genesis.name]: {
                header: false,
                relation: true,
                body: true,
                property: false,
                footer: false
            }
        }
    })

    const {
        store,
        router
    } = await import(`/services/${dapp}/src/this/index.mjs`);

    store.set('pathname', {
        pathname: `/services/${changeService[`${dapp}`].name}/src`
    });

    await import(`/services/${dapp}/src/component/auction-auth/index.mjs`);
    const { removeParamFromURL } = await import(`/services/${dapp}/src/this/index.mjs`);
    const { Fonts } = await import(`/services/${dapp}/src/fonts.mjs`);
    const { Models } = await import(`/services/${dapp}/src/models/index.mjs`);

    if (changeService[dapp].body.filter.top) {
        document.body.querySelector('#bodyFilterTop').style.display = 'flex';
    }

    const routes = await router(window, { location });

    if (location.pathname === '/') {
        history.pushState(routes.title, '', routes.path);
    }

    store.set('section', routes.key);

    await Fonts(`/services/${changeService[`${dapp}`].name}/src`);

    const mountPointSystem = {
        pathname: changeService.genesis.pathname,
        pathTemplate: changeService.genesis.name,
        mountPoint: document.body,
        cssLight: dapp
    };

    const params = new URLSearchParams(document.location.search);
    const code = params.get('code');

    // store.set('isCode', code !== null)
    store.set('isCode', true);

    if (code === null) {
        const singIn = async () => {
            const { system } = await import(`${changeService.genesis.pathname}/${changeService.genesis.name}.mjs`);

            store.set('current_service', changeService[`${dapp}`].name);

            store.set('service', Object.assign({
                [changeService.genesis.name]: {
                    header: true,
                    relation: true,
                    body: true,
                    property: false,
                    footer: true
                }
            }, {
                [changeService.genesis.name]: changeService[`${dapp}`][`${changeService.genesis.name}`]
            }));

            store.set('mount_self', mountPointSystem);

            system(mountPointSystem).catch((e) => {
                console.log('ERROR', e);
            });
        };

        singIn();
        auctionAuth.style.zIndex = -1;
        // document.addEventListener('rules-singIn', singIn, { once: true })
    } else {

        const models = await Models();

        const token = await models.post.auth.token({
            'reqType': 0,
            'data': code
        });

        const url = removeParamFromURL(window.location.href, 'code');
        window.history.pushState('', '', url);

        const { system } = await import(`${changeService.genesis.pathname}/${changeService.genesis.name}.mjs`);

        store.set('current_service', changeService[`${dapp}`].name);

        store.set('service', {
            system: {
                header: false,
                relation: true,
                body: true,
                property: false,
                footer: false
            }
        });

        store.set('mount_self', mountPointSystem)

        system(mountPointSystem).catch((e) => {
            console.log('ERROR', e);
        });
    }
</script>
</html>
